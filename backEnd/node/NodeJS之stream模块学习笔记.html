<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>【Node】NodeJS之stream模块学习笔记 | 南城花开zy</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/docs-zzy/images/logo.jpg">
    <meta name="description" content="乘风破浪会有时！">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="keywords" content="vuepress, blog, 前端, HTML5, CSS3，javascript, typescript">
    <meta name="copyright" content="zkk">
    <meta name="robots" content="all">
    <link rel="preload" href="/docs-zzy/assets/css/0.styles.8bb96e49.css" as="style"><link rel="preload" href="/docs-zzy/assets/js/app.f5fb1f06.js" as="script"><link rel="preload" href="/docs-zzy/assets/js/3.7a4e40be.js" as="script"><link rel="preload" href="/docs-zzy/assets/js/1.f25b10cd.js" as="script"><link rel="preload" href="/docs-zzy/assets/js/31.e76bf292.js" as="script"><link rel="prefetch" href="/docs-zzy/assets/js/10.d11b19ec.js"><link rel="prefetch" href="/docs-zzy/assets/js/100.ce777226.js"><link rel="prefetch" href="/docs-zzy/assets/js/101.755eaf0c.js"><link rel="prefetch" href="/docs-zzy/assets/js/102.fecc4609.js"><link rel="prefetch" href="/docs-zzy/assets/js/103.06077d3a.js"><link rel="prefetch" href="/docs-zzy/assets/js/104.ca408922.js"><link rel="prefetch" href="/docs-zzy/assets/js/105.4b6df64c.js"><link rel="prefetch" href="/docs-zzy/assets/js/106.47e13520.js"><link rel="prefetch" href="/docs-zzy/assets/js/107.745c0fea.js"><link rel="prefetch" href="/docs-zzy/assets/js/108.38f4f241.js"><link rel="prefetch" href="/docs-zzy/assets/js/109.991617d7.js"><link rel="prefetch" href="/docs-zzy/assets/js/11.114ab1ac.js"><link rel="prefetch" href="/docs-zzy/assets/js/110.4b3f1128.js"><link rel="prefetch" href="/docs-zzy/assets/js/111.42154d37.js"><link rel="prefetch" href="/docs-zzy/assets/js/112.c1b1c946.js"><link rel="prefetch" href="/docs-zzy/assets/js/113.1380d5d8.js"><link rel="prefetch" href="/docs-zzy/assets/js/114.d43228fe.js"><link rel="prefetch" href="/docs-zzy/assets/js/115.cabc3276.js"><link rel="prefetch" href="/docs-zzy/assets/js/116.26f15466.js"><link rel="prefetch" href="/docs-zzy/assets/js/117.28f6fb0c.js"><link rel="prefetch" href="/docs-zzy/assets/js/118.c495682f.js"><link rel="prefetch" href="/docs-zzy/assets/js/119.57c35116.js"><link rel="prefetch" href="/docs-zzy/assets/js/12.1992a4cd.js"><link rel="prefetch" href="/docs-zzy/assets/js/120.c7bad023.js"><link rel="prefetch" href="/docs-zzy/assets/js/121.b8eb46f1.js"><link rel="prefetch" href="/docs-zzy/assets/js/122.aab1f4b5.js"><link rel="prefetch" href="/docs-zzy/assets/js/123.c4574035.js"><link rel="prefetch" href="/docs-zzy/assets/js/124.b388f74d.js"><link rel="prefetch" href="/docs-zzy/assets/js/125.338c83ed.js"><link rel="prefetch" href="/docs-zzy/assets/js/126.49de3b75.js"><link rel="prefetch" href="/docs-zzy/assets/js/127.50a0a353.js"><link rel="prefetch" href="/docs-zzy/assets/js/128.b318515a.js"><link rel="prefetch" href="/docs-zzy/assets/js/129.b028c62e.js"><link rel="prefetch" href="/docs-zzy/assets/js/13.ad36c608.js"><link rel="prefetch" href="/docs-zzy/assets/js/130.9d88ba46.js"><link rel="prefetch" href="/docs-zzy/assets/js/131.941098a3.js"><link rel="prefetch" href="/docs-zzy/assets/js/132.d1018f2c.js"><link rel="prefetch" href="/docs-zzy/assets/js/133.e78db2ca.js"><link rel="prefetch" href="/docs-zzy/assets/js/134.1c8e82a0.js"><link rel="prefetch" href="/docs-zzy/assets/js/135.8cf299a4.js"><link rel="prefetch" href="/docs-zzy/assets/js/136.e1d06f12.js"><link rel="prefetch" href="/docs-zzy/assets/js/137.1e414b74.js"><link rel="prefetch" href="/docs-zzy/assets/js/138.5676e585.js"><link rel="prefetch" href="/docs-zzy/assets/js/139.619f6472.js"><link rel="prefetch" href="/docs-zzy/assets/js/14.7022b6e7.js"><link rel="prefetch" href="/docs-zzy/assets/js/140.55904f59.js"><link rel="prefetch" href="/docs-zzy/assets/js/141.1a450708.js"><link rel="prefetch" href="/docs-zzy/assets/js/142.4207ec1d.js"><link rel="prefetch" href="/docs-zzy/assets/js/143.d04b85ae.js"><link rel="prefetch" href="/docs-zzy/assets/js/144.f32a4caa.js"><link rel="prefetch" href="/docs-zzy/assets/js/145.609c8aff.js"><link rel="prefetch" href="/docs-zzy/assets/js/146.aa302989.js"><link rel="prefetch" href="/docs-zzy/assets/js/147.4706d41f.js"><link rel="prefetch" href="/docs-zzy/assets/js/148.a20fb0c7.js"><link rel="prefetch" href="/docs-zzy/assets/js/149.332df16c.js"><link rel="prefetch" href="/docs-zzy/assets/js/15.a142292c.js"><link rel="prefetch" href="/docs-zzy/assets/js/150.4ed99bcb.js"><link rel="prefetch" href="/docs-zzy/assets/js/151.f06868a2.js"><link rel="prefetch" href="/docs-zzy/assets/js/152.d4186b23.js"><link rel="prefetch" href="/docs-zzy/assets/js/153.fe4a7525.js"><link rel="prefetch" href="/docs-zzy/assets/js/154.01ea5683.js"><link rel="prefetch" href="/docs-zzy/assets/js/155.282557e7.js"><link rel="prefetch" href="/docs-zzy/assets/js/156.89296834.js"><link rel="prefetch" href="/docs-zzy/assets/js/157.6bf393ad.js"><link rel="prefetch" href="/docs-zzy/assets/js/158.70b1f4fd.js"><link rel="prefetch" href="/docs-zzy/assets/js/159.c36757a7.js"><link rel="prefetch" href="/docs-zzy/assets/js/16.d6ac0b4e.js"><link rel="prefetch" href="/docs-zzy/assets/js/160.7edfed0b.js"><link rel="prefetch" href="/docs-zzy/assets/js/161.8c94ca17.js"><link rel="prefetch" href="/docs-zzy/assets/js/162.1d61cef6.js"><link rel="prefetch" href="/docs-zzy/assets/js/163.d618e6a0.js"><link rel="prefetch" href="/docs-zzy/assets/js/164.b0cdc5fb.js"><link rel="prefetch" href="/docs-zzy/assets/js/165.ea04db22.js"><link rel="prefetch" href="/docs-zzy/assets/js/166.642f6cc5.js"><link rel="prefetch" href="/docs-zzy/assets/js/167.c83a3473.js"><link rel="prefetch" href="/docs-zzy/assets/js/168.2b238e6c.js"><link rel="prefetch" href="/docs-zzy/assets/js/169.f343477b.js"><link rel="prefetch" href="/docs-zzy/assets/js/17.580a60b2.js"><link rel="prefetch" href="/docs-zzy/assets/js/170.c471fa16.js"><link rel="prefetch" href="/docs-zzy/assets/js/171.7e1f20f0.js"><link rel="prefetch" href="/docs-zzy/assets/js/172.5c379d94.js"><link rel="prefetch" href="/docs-zzy/assets/js/173.a2356956.js"><link rel="prefetch" href="/docs-zzy/assets/js/174.6b48683a.js"><link rel="prefetch" href="/docs-zzy/assets/js/175.462e79a4.js"><link rel="prefetch" href="/docs-zzy/assets/js/176.9cf37049.js"><link rel="prefetch" href="/docs-zzy/assets/js/177.d03097df.js"><link rel="prefetch" href="/docs-zzy/assets/js/178.ce594d55.js"><link rel="prefetch" href="/docs-zzy/assets/js/179.6c67c249.js"><link rel="prefetch" href="/docs-zzy/assets/js/18.e01e1076.js"><link rel="prefetch" href="/docs-zzy/assets/js/180.52fb9e1d.js"><link rel="prefetch" href="/docs-zzy/assets/js/181.f37edc2f.js"><link rel="prefetch" href="/docs-zzy/assets/js/182.db8496ec.js"><link rel="prefetch" href="/docs-zzy/assets/js/183.666c93aa.js"><link rel="prefetch" href="/docs-zzy/assets/js/184.a5028353.js"><link rel="prefetch" href="/docs-zzy/assets/js/185.6becc5e2.js"><link rel="prefetch" href="/docs-zzy/assets/js/186.928b9f7e.js"><link rel="prefetch" href="/docs-zzy/assets/js/187.13974916.js"><link rel="prefetch" href="/docs-zzy/assets/js/188.19e8a717.js"><link rel="prefetch" href="/docs-zzy/assets/js/189.5caa0794.js"><link rel="prefetch" href="/docs-zzy/assets/js/19.94dc05cb.js"><link rel="prefetch" href="/docs-zzy/assets/js/190.707e6fe1.js"><link rel="prefetch" href="/docs-zzy/assets/js/191.d1642d03.js"><link rel="prefetch" href="/docs-zzy/assets/js/192.e76b65b2.js"><link rel="prefetch" href="/docs-zzy/assets/js/193.58c781e9.js"><link rel="prefetch" href="/docs-zzy/assets/js/194.467775df.js"><link rel="prefetch" href="/docs-zzy/assets/js/195.ffb35fac.js"><link rel="prefetch" href="/docs-zzy/assets/js/196.68cd7176.js"><link rel="prefetch" href="/docs-zzy/assets/js/197.b616de42.js"><link rel="prefetch" href="/docs-zzy/assets/js/198.c8e0d9fa.js"><link rel="prefetch" href="/docs-zzy/assets/js/199.547d1b96.js"><link rel="prefetch" href="/docs-zzy/assets/js/20.967b6ad9.js"><link rel="prefetch" href="/docs-zzy/assets/js/200.b27411af.js"><link rel="prefetch" href="/docs-zzy/assets/js/201.9fec6a21.js"><link rel="prefetch" href="/docs-zzy/assets/js/202.781ca8a2.js"><link rel="prefetch" href="/docs-zzy/assets/js/203.5bc8a0e9.js"><link rel="prefetch" href="/docs-zzy/assets/js/204.81a9c99a.js"><link rel="prefetch" href="/docs-zzy/assets/js/205.52f8fc52.js"><link rel="prefetch" href="/docs-zzy/assets/js/206.1d69ee13.js"><link rel="prefetch" href="/docs-zzy/assets/js/21.16780566.js"><link rel="prefetch" href="/docs-zzy/assets/js/22.5bbf7ba9.js"><link rel="prefetch" href="/docs-zzy/assets/js/23.776bf181.js"><link rel="prefetch" href="/docs-zzy/assets/js/24.a60d68a8.js"><link rel="prefetch" href="/docs-zzy/assets/js/25.1570c61d.js"><link rel="prefetch" href="/docs-zzy/assets/js/26.92ab932a.js"><link rel="prefetch" href="/docs-zzy/assets/js/27.504ede54.js"><link rel="prefetch" href="/docs-zzy/assets/js/28.3aeca2b4.js"><link rel="prefetch" href="/docs-zzy/assets/js/29.d612a0f4.js"><link rel="prefetch" href="/docs-zzy/assets/js/30.12290ef0.js"><link rel="prefetch" href="/docs-zzy/assets/js/32.0d581241.js"><link rel="prefetch" href="/docs-zzy/assets/js/33.738a3689.js"><link rel="prefetch" href="/docs-zzy/assets/js/34.947e8e37.js"><link rel="prefetch" href="/docs-zzy/assets/js/35.41d95136.js"><link rel="prefetch" href="/docs-zzy/assets/js/36.665e1c4c.js"><link rel="prefetch" href="/docs-zzy/assets/js/37.c70ad7b0.js"><link rel="prefetch" href="/docs-zzy/assets/js/38.08fdfc4b.js"><link rel="prefetch" href="/docs-zzy/assets/js/39.4ff12d5c.js"><link rel="prefetch" href="/docs-zzy/assets/js/4.535e6d3a.js"><link rel="prefetch" href="/docs-zzy/assets/js/40.47416bf7.js"><link rel="prefetch" href="/docs-zzy/assets/js/41.a72f5746.js"><link rel="prefetch" href="/docs-zzy/assets/js/42.80dc4bda.js"><link rel="prefetch" href="/docs-zzy/assets/js/43.04ebe401.js"><link rel="prefetch" href="/docs-zzy/assets/js/44.4de45318.js"><link rel="prefetch" href="/docs-zzy/assets/js/45.e2ce8f3a.js"><link rel="prefetch" href="/docs-zzy/assets/js/46.5b5b2f72.js"><link rel="prefetch" href="/docs-zzy/assets/js/47.51a39a52.js"><link rel="prefetch" href="/docs-zzy/assets/js/48.3df4f657.js"><link rel="prefetch" href="/docs-zzy/assets/js/49.1b2b5cea.js"><link rel="prefetch" href="/docs-zzy/assets/js/5.90bf17f7.js"><link rel="prefetch" href="/docs-zzy/assets/js/50.d2500549.js"><link rel="prefetch" href="/docs-zzy/assets/js/51.5763bb06.js"><link rel="prefetch" href="/docs-zzy/assets/js/52.623081ca.js"><link rel="prefetch" href="/docs-zzy/assets/js/53.947891d7.js"><link rel="prefetch" href="/docs-zzy/assets/js/54.7c58a8aa.js"><link rel="prefetch" href="/docs-zzy/assets/js/55.97d5ded0.js"><link rel="prefetch" href="/docs-zzy/assets/js/56.a183afb9.js"><link rel="prefetch" href="/docs-zzy/assets/js/57.7b707ed2.js"><link rel="prefetch" href="/docs-zzy/assets/js/58.041d3c64.js"><link rel="prefetch" href="/docs-zzy/assets/js/59.08bde581.js"><link rel="prefetch" href="/docs-zzy/assets/js/6.43f7cb13.js"><link rel="prefetch" href="/docs-zzy/assets/js/60.05d24d18.js"><link rel="prefetch" href="/docs-zzy/assets/js/61.9036ad6a.js"><link rel="prefetch" href="/docs-zzy/assets/js/62.38af4da9.js"><link rel="prefetch" href="/docs-zzy/assets/js/63.e8e722ae.js"><link rel="prefetch" href="/docs-zzy/assets/js/64.647d8b94.js"><link rel="prefetch" href="/docs-zzy/assets/js/65.09c4cdc1.js"><link rel="prefetch" href="/docs-zzy/assets/js/66.19e3dfc1.js"><link rel="prefetch" href="/docs-zzy/assets/js/67.f353ca13.js"><link rel="prefetch" href="/docs-zzy/assets/js/68.f0bef705.js"><link rel="prefetch" href="/docs-zzy/assets/js/69.1cdc30c8.js"><link rel="prefetch" href="/docs-zzy/assets/js/7.57e6d995.js"><link rel="prefetch" href="/docs-zzy/assets/js/70.02fa5c70.js"><link rel="prefetch" href="/docs-zzy/assets/js/71.cc415905.js"><link rel="prefetch" href="/docs-zzy/assets/js/72.15fa2443.js"><link rel="prefetch" href="/docs-zzy/assets/js/73.2fc0da6f.js"><link rel="prefetch" href="/docs-zzy/assets/js/74.a8a6e6ee.js"><link rel="prefetch" href="/docs-zzy/assets/js/75.3c6ee1d3.js"><link rel="prefetch" href="/docs-zzy/assets/js/76.66cb7b81.js"><link rel="prefetch" href="/docs-zzy/assets/js/77.b371b743.js"><link rel="prefetch" href="/docs-zzy/assets/js/78.40b39282.js"><link rel="prefetch" href="/docs-zzy/assets/js/79.11a2dcfc.js"><link rel="prefetch" href="/docs-zzy/assets/js/8.de580b21.js"><link rel="prefetch" href="/docs-zzy/assets/js/80.251c5284.js"><link rel="prefetch" href="/docs-zzy/assets/js/81.fc0233ea.js"><link rel="prefetch" href="/docs-zzy/assets/js/82.743027ea.js"><link rel="prefetch" href="/docs-zzy/assets/js/83.8761e2ea.js"><link rel="prefetch" href="/docs-zzy/assets/js/84.505930ba.js"><link rel="prefetch" href="/docs-zzy/assets/js/85.4369fc8e.js"><link rel="prefetch" href="/docs-zzy/assets/js/86.94e563c7.js"><link rel="prefetch" href="/docs-zzy/assets/js/87.28486615.js"><link rel="prefetch" href="/docs-zzy/assets/js/88.00c3cb8f.js"><link rel="prefetch" href="/docs-zzy/assets/js/89.59da4926.js"><link rel="prefetch" href="/docs-zzy/assets/js/9.f0533b1f.js"><link rel="prefetch" href="/docs-zzy/assets/js/90.e95c3cec.js"><link rel="prefetch" href="/docs-zzy/assets/js/91.0e5a7efe.js"><link rel="prefetch" href="/docs-zzy/assets/js/92.8f5436bd.js"><link rel="prefetch" href="/docs-zzy/assets/js/93.b180ffcb.js"><link rel="prefetch" href="/docs-zzy/assets/js/94.cdda4492.js"><link rel="prefetch" href="/docs-zzy/assets/js/95.aeb95a11.js"><link rel="prefetch" href="/docs-zzy/assets/js/96.e6d20b74.js"><link rel="prefetch" href="/docs-zzy/assets/js/97.c7c50823.js"><link rel="prefetch" href="/docs-zzy/assets/js/98.1d569528.js"><link rel="prefetch" href="/docs-zzy/assets/js/99.f7f3e2da.js">
    <link rel="stylesheet" href="/docs-zzy/assets/css/0.styles.8bb96e49.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-541b60e8><div data-v-541b60e8><div id="loader-wrapper" class="loading-wrapper" data-v-71fac282 data-v-541b60e8 data-v-541b60e8><div class="loader-main" data-v-71fac282><div data-v-71fac282></div><div data-v-71fac282></div><div data-v-71fac282></div><div data-v-71fac282></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-7ba865aa data-v-541b60e8 data-v-541b60e8><h3 class="title" style="display:none;" data-v-7ba865aa data-v-7ba865aa>南城花开zy</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-7ba865aa data-v-7ba865aa><input type="password" value="" data-v-7ba865aa> <span data-v-7ba865aa>Konck! Knock!</span> <button data-v-7ba865aa>OK</button></label> <div class="footer" style="display:none;" data-v-7ba865aa data-v-7ba865aa><span data-v-7ba865aa><i class="iconfont reco-theme" data-v-7ba865aa></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-7ba865aa>vuePress-theme-reco</a></span> <span data-v-7ba865aa><i class="iconfont reco-copyright" data-v-7ba865aa></i> <a data-v-7ba865aa><span data-v-7ba865aa>南城花开zy</span>
            
          <!---->
          2020
        </a></span></div></div> <div class="hide" data-v-541b60e8><header class="navbar" data-v-541b60e8><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs-zzy/" class="home-link router-link-active"><img src="/docs-zzy/images/logo.jpg" alt="南城花开zy" class="logo"> <span class="site-name">南城花开zy</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs-zzy/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-api"></i>
      前端
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/docs-zzy/frontEnd/html/" class="nav-link"><i class="iconfont undefined"></i>
  HTML
</a></li><li class="dropdown-subitem"><a href="/docs-zzy/frontEnd/css/" class="nav-link"><i class="iconfont undefined"></i>
  CSS
</a></li><li class="dropdown-subitem"><a href="/docs-zzy/frontEnd/jsJC/" class="nav-link"><i class="iconfont undefined"></i>
  JS基础
</a></li><li class="dropdown-subitem"><a href="/docs-zzy/frontEnd/jsJJ/" class="nav-link"><i class="iconfont undefined"></i>
  JS进阶
</a></li></ul></li><li class="dropdown-item"><h4>框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/docs-zzy/frontEnd/VAR/vue/" class="nav-link"><i class="iconfont undefined"></i>
  vue
</a></li><li class="dropdown-subitem"><a href="/docs-zzy/frontEnd/VAR/react/" class="nav-link"><i class="iconfont undefined"></i>
  react
</a></li><li class="dropdown-subitem"><a href="/docs-zzy/frontEnd/VAR/jquery/" class="nav-link"><i class="iconfont undefined"></i>
  jquery
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-coding"></i>
      后端
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Node</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/docs-zzy/backEnd/node/" class="nav-link router-link-active"><i class="iconfont undefined"></i>
  node基础
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-other"></i>
      其他
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs-zzy/other/git/" class="nav-link"><i class="iconfont undefined"></i>
  Git
</a></li><li class="dropdown-item"><!----> <a href="/docs-zzy/other/interview/" class="nav-link"><i class="iconfont undefined"></i>
  面试
</a></li><li class="dropdown-item"><!----> <a href="/docs-zzy/other/tool/" class="nav-link"><i class="iconfont undefined"></i>
  工具
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs-zzy/categories/后端/" class="nav-link"><i class="iconfont undefined"></i>
  后端
</a></li><li class="dropdown-item"><!----> <a href="/docs-zzy/categories/前端/" class="nav-link"><i class="iconfont undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/docs-zzy/categories/其他/" class="nav-link"><i class="iconfont undefined"></i>
  其他
</a></li><li class="dropdown-item"><!----> <a href="/docs-zzy/categories/webpack/" class="nav-link"><i class="iconfont undefined"></i>
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/docs-zzy/categories/性能优化/" class="nav-link"><i class="iconfont undefined"></i>
  性能优化
</a></li></ul></div></div><div class="nav-item"><a href="/docs-zzy/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div> <a href="https://github.com/zzy11027" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask" data-v-541b60e8></div> <aside class="sidebar" data-v-541b60e8><div class="personal-info-wrapper" data-v-5f8262b6 data-v-541b60e8><img src="/docs-zzy/images/logo.jpg" alt="author-avatar" class="personal-img" data-v-5f8262b6> <h3 class="name" data-v-5f8262b6>
    南城花开zy
  </h3> <div class="num" data-v-5f8262b6><div data-v-5f8262b6><h3 data-v-5f8262b6>185</h3> <h6 data-v-5f8262b6>文章</h6></div> <div data-v-5f8262b6><h3 data-v-5f8262b6>22</h3> <h6 data-v-5f8262b6>标签</h6></div></div> <hr data-v-5f8262b6></div> <nav class="nav-links"><div class="nav-item"><a href="/docs-zzy/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-api"></i>
      前端
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/docs-zzy/frontEnd/html/" class="nav-link"><i class="iconfont undefined"></i>
  HTML
</a></li><li class="dropdown-subitem"><a href="/docs-zzy/frontEnd/css/" class="nav-link"><i class="iconfont undefined"></i>
  CSS
</a></li><li class="dropdown-subitem"><a href="/docs-zzy/frontEnd/jsJC/" class="nav-link"><i class="iconfont undefined"></i>
  JS基础
</a></li><li class="dropdown-subitem"><a href="/docs-zzy/frontEnd/jsJJ/" class="nav-link"><i class="iconfont undefined"></i>
  JS进阶
</a></li></ul></li><li class="dropdown-item"><h4>框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/docs-zzy/frontEnd/VAR/vue/" class="nav-link"><i class="iconfont undefined"></i>
  vue
</a></li><li class="dropdown-subitem"><a href="/docs-zzy/frontEnd/VAR/react/" class="nav-link"><i class="iconfont undefined"></i>
  react
</a></li><li class="dropdown-subitem"><a href="/docs-zzy/frontEnd/VAR/jquery/" class="nav-link"><i class="iconfont undefined"></i>
  jquery
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-coding"></i>
      后端
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Node</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/docs-zzy/backEnd/node/" class="nav-link router-link-active"><i class="iconfont undefined"></i>
  node基础
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-other"></i>
      其他
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs-zzy/other/git/" class="nav-link"><i class="iconfont undefined"></i>
  Git
</a></li><li class="dropdown-item"><!----> <a href="/docs-zzy/other/interview/" class="nav-link"><i class="iconfont undefined"></i>
  面试
</a></li><li class="dropdown-item"><!----> <a href="/docs-zzy/other/tool/" class="nav-link"><i class="iconfont undefined"></i>
  工具
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs-zzy/categories/后端/" class="nav-link"><i class="iconfont undefined"></i>
  后端
</a></li><li class="dropdown-item"><!----> <a href="/docs-zzy/categories/前端/" class="nav-link"><i class="iconfont undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/docs-zzy/categories/其他/" class="nav-link"><i class="iconfont undefined"></i>
  其他
</a></li><li class="dropdown-item"><!----> <a href="/docs-zzy/categories/webpack/" class="nav-link"><i class="iconfont undefined"></i>
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/docs-zzy/categories/性能优化/" class="nav-link"><i class="iconfont undefined"></i>
  性能优化
</a></li></ul></div></div><div class="nav-item"><a href="/docs-zzy/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div> <a href="https://github.com/zzy11027" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>NodeJS学习笔记</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs-zzy/backEnd/node/NodeJS简介.html" class="sidebar-link">【Node】NodeJS简介</a></li><li><a href="/docs-zzy/backEnd/node/NodeJS之HelloWorld.html" class="sidebar-link">【Node】NodeJS之HelloWorld</a></li><li><a href="/docs-zzy/backEnd/node/事件驱动和非阻塞机制.html" class="sidebar-link">异步编程</a></li><li><a href="/docs-zzy/backEnd/node/CommonJS.html" class="sidebar-link">CommonJs</a></li><li><a href="/docs-zzy/backEnd/node/NodeJS之Buffer模块学习笔记.html" class="sidebar-link">【Node】NodeJS之Buffer模块学习笔记</a></li><li><a href="/docs-zzy/backEnd/node/NodeJS之child_process模块学习笔记.html" class="sidebar-link">【Node】NodeJS之child_process模块学习笔记</a></li><li><a href="/docs-zzy/backEnd/node/NodeJS之cluster模块学习笔记.html" class="sidebar-link">【Node】NodeJS之cluster模块学习笔记</a></li><li><a href="/docs-zzy/backEnd/node/NodeJS之console模块学习笔记.html" class="sidebar-link">【Node】NodeJS之console模块学习笔记</a></li><li><a href="/docs-zzy/backEnd/node/NodeJS之events模块学习笔记.html" class="sidebar-link">【Node】NodeJS之events模块学习笔记</a></li><li><a href="/docs-zzy/backEnd/node/NodeJS之fs模块学习笔记.html" class="sidebar-link">【Node】NodeJS之fs模块学习笔记</a></li><li><a href="/docs-zzy/backEnd/node/NodeJS之global全局变量学习笔记.html" class="sidebar-link">【Node】NodeJS之global全局变量学习笔记</a></li><li><a href="/docs-zzy/backEnd/node/NodeJS之HTTP模块学习笔记.html" class="sidebar-link">【Node】NodeJS之HTTP模块学习笔记</a></li><li><a href="/docs-zzy/backEnd/node/NodeJS之MD5加密.html" class="sidebar-link">【Node】NodeJS之MD5加密</a></li><li><a href="/docs-zzy/backEnd/node/NodeJS之module模块学习笔记.html" class="sidebar-link">【Node】NodeJS之module模块学习笔记</a></li><li><a href="/docs-zzy/backEnd/node/NodeJS之net模块学习笔记.html" class="sidebar-link">【Node】NodeJS之net模块学习笔记</a></li><li><a href="/docs-zzy/backEnd/node/NodeJS之os模块学习笔记.html" class="sidebar-link">【Node】NodeJS之os模块学习笔记</a></li><li><a href="/docs-zzy/backEnd/node/NodeJS之path模块学习笔记.html" class="sidebar-link">【Node】NodeJS之path模块学习笔记</a></li><li><a href="/docs-zzy/backEnd/node/NodeJS之process模块学习笔记.html" class="sidebar-link">【Node】NodeJS之process模块学习笔记</a></li><li><a href="/docs-zzy/backEnd/node/NodeJS之querystring模块学习笔记.html" class="sidebar-link">【Node】NodeJS之querystring模块学习笔记</a></li><li><a href="/docs-zzy/backEnd/node/NodeJS之stream模块学习笔记.html" class="active sidebar-link">【Node】NodeJS之stream模块学习笔记</a></li><li><a href="/docs-zzy/backEnd/node/NodeJS之timer模块学习笔记.html" class="sidebar-link">【Node】NodeJS之timer模块学习笔记</a></li><li><a href="/docs-zzy/backEnd/node/NodeJS之url模块学习笔记.html" class="sidebar-link">【Node】NodeJS之url模块学习笔记</a></li><li><a href="/docs-zzy/backEnd/node/NodeJS之util实用工具模块学习笔记.html" class="sidebar-link">【Node】NodeJS之util实用工具模块学习笔记</a></li><li><a href="/docs-zzy/backEnd/node/NodeJS之web-socket和Socket框架.html" class="sidebar-link">【Node】NodeJS之web socket和Socket框架</a></li><li><a href="/docs-zzy/backEnd/node/NodeJS之zlib压缩模块学习笔记.html" class="sidebar-link">【Node】NodeJS之zlib压缩模块学习笔记</a></li><li><a href="/docs-zzy/backEnd/node/NodeJS之操作MongoDB数据库.html" class="sidebar-link">【Node】NodeJS之操作MongoDB数据库</a></li><li><a href="/docs-zzy/backEnd/node/NodeJS之设置Cookie和Session.html" class="sidebar-link">【Node】NodeJS之设置Cookie和Session</a></li><li><a href="/docs-zzy/backEnd/node/Express框架学习笔记.html" class="sidebar-link">【Node】Express web 开发框架学习笔记</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-7ba865aa data-v-541b60e8><h3 class="title" style="display:none;" data-v-7ba865aa data-v-7ba865aa>【Node】NodeJS之stream模块学习笔记</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-7ba865aa data-v-7ba865aa><input type="password" value="" data-v-7ba865aa> <span data-v-7ba865aa>Konck! Knock!</span> <button data-v-7ba865aa>OK</button></label> <div class="footer" style="display:none;" data-v-7ba865aa data-v-7ba865aa><span data-v-7ba865aa><i class="iconfont reco-theme" data-v-7ba865aa></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-7ba865aa>vuePress-theme-reco</a></span> <span data-v-7ba865aa><i class="iconfont reco-copyright" data-v-7ba865aa></i> <a data-v-7ba865aa><span data-v-7ba865aa>南城花开zy</span>
            
          <!---->
          2020
        </a></span></div></div> <div data-v-541b60e8><main class="page"><div class="page-title" style="display:none;"><h1>【Node】NodeJS之stream模块学习笔记</h1> <hr> <div data-v-88e9c2ee><i class="iconfont reco-account" data-v-88e9c2ee><span data-v-88e9c2ee>南城花开zy</span></i> <i class="iconfont reco-date" data-v-88e9c2ee><span data-v-88e9c2ee>2019-09-01</span></i> <!----> <i class="iconfont reco-tag tags" data-v-88e9c2ee><span class="tag-item" data-v-88e9c2ee>Node</span><span class="tag-item" data-v-88e9c2ee>JS</span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><h1 id="nodejs之stream模块学习笔记"><a href="#nodejs之stream模块学习笔记" class="header-anchor">🌙</a> NodeJS之stream模块学习笔记</h1> <h2 id="_1-stream（流）模块简介"><a href="#_1-stream（流）模块简介" class="header-anchor">🌙</a> 1.stream（流）模块简介</h2> <p>流（stream）是 Node.js 中处理流式数据的抽象接口。 <code>stream</code> 模块用于构建实现了流接口的对象。</p> <p>Node.js 提供了多种流对象。 例如，<a href="http://nodejs.cn/s/2RqpEw" target="_blank" rel="noopener noreferrer">HTTP 服务器的请求<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和 <a href="http://nodejs.cn/s/tQWUzG" target="_blank" rel="noopener noreferrer"><code>process.stdout</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 都是流的实例。</p> <p>流可以是可读的、可写的、或者可读可写的。 所有的流都是 <a href="http://nodejs.cn/s/pGAddE" target="_blank" rel="noopener noreferrer"><code>EventEmitter</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的实例。</p> <p>访问 <code>stream</code> 模块：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> stream <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>尽管理解流的工作方式很重要，但是 <code>stream</code> 模块主要用于开发者创建新类型的流实例。 对于以消费流对象为主的开发者，极少需要直接使用 <code>stream</code> 模块。</p> <h2 id="_2-流的类型"><a href="#_2-流的类型" class="header-anchor">🌙</a> 2. 流的类型</h2> <p>Node.js 中有四种基本的流类型：</p> <ul><li><a href="http://nodejs.cn/s/9JUnJ8" target="_blank" rel="noopener noreferrer"><code>Writable</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> - 可写入数据的流（例如 <a href="http://nodejs.cn/s/VdSJQa" target="_blank" rel="noopener noreferrer"><code>fs.createWriteStream()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）。</li> <li><a href="http://nodejs.cn/s/YuDKX1" target="_blank" rel="noopener noreferrer"><code>Readable</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> - 可读取数据的流（例如 <a href="http://nodejs.cn/s/wiVPXD" target="_blank" rel="noopener noreferrer"><code>fs.createReadStream()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）。</li> <li><a href="http://nodejs.cn/s/2iRabr" target="_blank" rel="noopener noreferrer"><code>Duplex</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> - 可读又可写的流（例如 <a href="http://nodejs.cn/s/wsJ1o1" target="_blank" rel="noopener noreferrer"><code>net.Socket</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）。</li> <li><a href="http://nodejs.cn/s/fhVJQM" target="_blank" rel="noopener noreferrer"><code>Transform</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> - 在读写过程中可以修改或转换数据的 <code>Duplex</code> 流（例如 <a href="http://nodejs.cn/s/n6ED45" target="_blank" rel="noopener noreferrer"><code>zlib.createDeflate()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）。</li></ul> <p>此外，该模块还包括实用函数 <a href="http://nodejs.cn/s/kGvtzK" target="_blank" rel="noopener noreferrer"><code>stream.pipeline()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="http://nodejs.cn/s/DjDduq" target="_blank" rel="noopener noreferrer"><code>stream.finished()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和 <a href="http://nodejs.cn/s/bSCxhZ" target="_blank" rel="noopener noreferrer"><code>stream.Readable.from()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h2 id="_3-可写流-stream-writable"><a href="#_3-可写流-stream-writable" class="header-anchor">🌙</a> 3.可写流 <code>stream.Writable</code></h2> <p>可写流是对数据要被写入的目的地的一种抽象。</p> <p>可写流的例子包括：</p> <ul><li><a href="http://nodejs.cn/s/2F5RHd" target="_blank" rel="noopener noreferrer">客户端的 HTTP 请求<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://nodejs.cn/s/rMXoZ1" target="_blank" rel="noopener noreferrer">服务器的 HTTP 响应<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://nodejs.cn/s/2uZDVA" target="_blank" rel="noopener noreferrer">fs 的写入流<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://nodejs.cn/s/duYbh2" target="_blank" rel="noopener noreferrer">zlib 流<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://nodejs.cn/s/FuEfsg" target="_blank" rel="noopener noreferrer">crypto 流<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://nodejs.cn/s/wsJ1o1" target="_blank" rel="noopener noreferrer">TCP socket<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://nodejs.cn/s/Su8gEr" target="_blank" rel="noopener noreferrer">子进程 stdin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://nodejs.cn/s/tQWUzG" target="_blank" rel="noopener noreferrer"><code>process.stdout</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="http://nodejs.cn/s/wPv5zY" target="_blank" rel="noopener noreferrer"><code>process.stderr</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>上面的一些例子事实上是实现了可写流接口的 <a href="http://nodejs.cn/s/2iRabr" target="_blank" rel="noopener noreferrer"><code>Duplex</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 流。</p> <p>所有可写流都实现了 <code>stream.Writable</code> 类定义的接口。</p> <p>尽管可写流的具体实例可能略有差别，但所有的可写流都遵循同一基本的使用模式，如以下例子所示：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> myStream <span class="token operator">=</span> <span class="token function">getWritableStreamSomehow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'一些数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'更多数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myStream<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'完成写入数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-1-stream-writable-事件"><a href="#_3-1-stream-writable-事件" class="header-anchor">🌙</a> 3.1 <code>stream.Writable</code> 事件</h3> <table><thead><tr><th>事件名称</th> <th>说明</th></tr></thead> <tbody><tr><td><code>close</code></td> <td>当流或其底层资源（比如文件描述符）被关闭时触发。 表明不会再触发其他事件，也不会再发生操作。如果使用 <code>emitClose</code> 选项创建<a href="http://nodejs.cn/s/9JUnJ8" target="_blank" rel="noopener noreferrer">可写流<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，则它将会始终发出 <code>'close'</code> 事件。</td></tr> <tr><td><code>drain</code></td> <td>如果调用 <a href="http://nodejs.cn/s/doppiK" target="_blank" rel="noopener noreferrer"><code>stream.write(chunk)</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 返回 <code>false</code>，则当可以继续写入数据到流时会触发 <code>'drain'</code> 事件。</td></tr> <tr><td><code>error</code></td> <td>如果在写入或管道数据时发生错误，则会触发 <code>'error'</code> 事件。 当调用时，监听器回调会传入一个 <code>Error</code> 参数。除非在创建流时将 <a href="http://nodejs.cn/s/u7KYa2" target="_blank" rel="noopener noreferrer"><code>autoDestroy</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 选项设置为 <code>false</code>，否则在触发 <code>'error'</code> 事件时流会被关闭。在 <code>'error'</code> 之后，除 <code>'close'</code> 事件外，不应再触发其他事件（包括 <code>'error'</code> 事件）。</td></tr> <tr><td><code>finish</code></td> <td>调用 <a href="http://nodejs.cn/s/nvArK4" target="_blank" rel="noopener noreferrer"><code>stream.end()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 且缓冲数据都已传给底层系统之后触发。</td></tr> <tr><td><code>pipe</code></td> <td>当在可读流上调用 <a href="http://nodejs.cn/s/Ea2ZNW" target="_blank" rel="noopener noreferrer"><code>stream.pipe()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 方法时会发出 <code>'pipe'</code> 事件，并将此可写流添加到其目标集。</td></tr> <tr><td><code>unpipe</code></td> <td>在可读流上调用 <a href="http://nodejs.cn/s/35GqHX" target="_blank" rel="noopener noreferrer"><code>stream.unpipe()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 方法时会发出 <code>'unpipe'</code>事件，从其目标集中移除此可写流。当可读流通过管道流向可写流发生错误时，也会触发此事件。</td></tr></tbody></table> <h3 id="_3-2-stream-writable方法"><a href="#_3-2-stream-writable方法" class="header-anchor">🌙</a> 3.2 <code>stream.Writable</code>方法</h3> <ul><li><p><code>writable.cork()</code>：强制把所有写入的数据都缓冲到内存中。 当调用 <a href="http://nodejs.cn/s/2Bzt8L" target="_blank" rel="noopener noreferrer"><code>stream.uncork()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 或 <a href="http://nodejs.cn/s/nvArK4" target="_blank" rel="noopener noreferrer"><code>stream.end()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 方法时，缓冲的数据才会被输出。</p></li> <li><p><code>writable.destroy([error])</code>：销毁流。 可选地触发 <code>'error'</code>，并且触发 <code>'close'</code> 事件（除非将 <code>emitClose</code> 设置为 <code>false</code>）。</p> <ul><li><code>error</code> <a href="http://nodejs.cn/s/qZ873x" target="_blank" rel="noopener noreferrer"><Error><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></Error></a> 可选，使用 <code>'error'</code> 事件触发的错误。</li> <li>返回: <a href="http://nodejs.cn/s/v7Fsu2" target="_blank" rel="noopener noreferrer"><this><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></this></a></li></ul></li> <li><p><code>writable.destroyed</code> : <boolean> 在调用了 <a href="http://nodejs.cn/s/tLkQ7J" target="_blank" rel="noopener noreferrer"><code>writable.destroy()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 之后为 <code>true</code>。</boolean></p></li> <li><p><code>writable.end([chunk[, encoding]][, callback])</code>:调用 <code>writable.end()</code> 表明已没有数据要被写入<a href="http://nodejs.cn/s/9JUnJ8" target="_blank" rel="noopener noreferrer">可写流<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。 可选的 <code>chunk</code> 和 <code>encoding</code> 参数可以在关闭流之前再写入一块数据。 如果传入了 <code>callback</code> 函数，则会做为监听器添加到 <a href="http://nodejs.cn/s/VBJRc8" target="_blank" rel="noopener noreferrer"><code>'finish'</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 事件和 <code>'error'</code> 事件。</p> <ul><li><code>chunk</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="noopener noreferrer"><string><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></string></a> | <a href="http://nodejs.cn/s/6x1hD3" target="_blank" rel="noopener noreferrer"><Buffer><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></Buffer></a> | <a href="http://nodejs.cn/s/ZbDkpm" target="_blank" rel="noopener noreferrer"><Uint8Array><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></Uint8Array></a> | <a href="http://nodejs.cn/s/6sTGdS" target="_blank" rel="noopener noreferrer"><any><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></any></a> 要写入的数据。 对于非对象模式的流， <code>chunk</code> 必须是字符串、 <code>Buffer</code>、或 <code>Uint8Array</code>。 对于对象模式的流， <code>chunk</code> 可以是任何 JavaScript 值，除了 <code>null</code>。</li> <li><code>encoding</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="noopener noreferrer"><string><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></string></a> 如果 <code>chunk</code> 是字符串，则指定字符编码。</li> <li><code>callback</code> <a href="http://nodejs.cn/s/ceTQa6" target="_blank" rel="noopener noreferrer"><function><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></function></a> 当流结束或报错时的回调函数。</li> <li>返回: <a href="http://nodejs.cn/s/v7Fsu2" target="_blank" rel="noopener noreferrer"><this><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></this></a></li></ul> <p>调用 <a href="http://nodejs.cn/s/nvArK4" target="_blank" rel="noopener noreferrer"><code>stream.end()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 之后再调用 <a href="http://nodejs.cn/s/doppiK" target="_blank" rel="noopener noreferrer"><code>stream.write()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 会导致错误。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 先写入 'hello, '，结束前再写入 'world!'。</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> file <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'例子.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
file<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'hello, '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
file<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'world!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 后面不允许再写入数据！</span>
</code></pre></div></li> <li><p><code>writable.setDefaultEncoding(encoding)</code>为<a href="http://nodejs.cn/s/9JUnJ8" target="_blank" rel="noopener noreferrer">可写流<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>设置默认的 <code>encoding</code>。返回：<this></this></p></li> <li><p><code>writable.uncork()</code>调用 <a href="http://nodejs.cn/s/HbaGHW" target="_blank" rel="noopener noreferrer"><code>stream.cork()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 后缓冲的所有数据输出到目标。</p> <p>当使用 <a href="http://nodejs.cn/s/HbaGHW" target="_blank" rel="noopener noreferrer"><code>writable.cork()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和 <code>writable.uncork()</code> 来管理流的写入缓冲时，建议使用 <code>process.nextTick()</code> 来延迟调用 <code>writable.uncork()</code>。 通过这种方式，可以对单个 Node.js 事件循环中调用的所有 <code>writable.write()</code> 进行批处理。</p> <div class="language-js extra-class"><pre class="language-js"><code>stream<span class="token punctuation">.</span><span class="token function">cork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'一些 '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'数据 '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> stream<span class="token punctuation">.</span><span class="token function">uncork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果一个流上多次调用 <a href="http://nodejs.cn/s/HbaGHW" target="_blank" rel="noopener noreferrer"><code>writable.cork()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，则必须调用同样次数的 <code>writable.uncork()</code> 才能输出缓冲的数据。</p> <div class="language-js extra-class"><pre class="language-js"><code>stream<span class="token punctuation">.</span><span class="token function">cork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'一些 '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stream<span class="token punctuation">.</span><span class="token function">cork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'数据 '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  stream<span class="token punctuation">.</span><span class="token function">uncork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 数据不会被输出，直到第二次调用 uncork()。</span>
  stream<span class="token punctuation">.</span><span class="token function">uncork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p><code>writable.write(chunk[, encoding][, callback])</code></p> <ul><li><code>chunk</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="noopener noreferrer"><string><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></string></a> | <a href="http://nodejs.cn/s/6x1hD3" target="_blank" rel="noopener noreferrer"><Buffer><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></Buffer></a> | <a href="http://nodejs.cn/s/ZbDkpm" target="_blank" rel="noopener noreferrer"><Uint8Array><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></Uint8Array></a> | [<any>](要写入的数据。  对于非对象模式的流， <code>chunk</code> 必须是字符串、 <code>Buffer</code> 或 <code>Uint8Array</code>。 对于对象模式的流， <code>chunk</code> 可以是任何 JavaScript 值，除了 <code>null</code>。</any></li> <li><code>encoding</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="noopener noreferrer"><string><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></string></a> 如果 <code>chunk</code> 是字符串，则指定字符编码。</li> <li><code>callback</code> <a href="http://nodejs.cn/s/ceTQa6" target="_blank" rel="noopener noreferrer"><function><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></function></a> 当数据块被输出到目标后的回调函数。</li> <li>返回: <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="noopener noreferrer"><boolean><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></boolean></a> 如果流需要等待 <code>'drain'</code> 事件触发才能继续写入更多数据，则返回 <code>false</code>，否则返回 <code>true</code>。</li></ul> <p><code>writable.write()</code> 写入数据到流，并在数据被完全处理之后调用 <code>callback</code>。 如果发生错误，则 <code>callback</code> 可能被调用也可能不被调用。 为了可靠地检测错误，可以为 <code>'error'</code> 事件添加监听器。 <code>callback</code> 会在触发 <code>'error'</code> 之前被异步地调用。</p> <p>在接收了 <code>chunk</code> 后，如果内部的缓冲小于创建流时配置的 <code>highWaterMark</code>，则返回 <code>true</code> 。 如果返回 <code>false</code> ，则应该停止向流写入数据，直到 <a href="http://nodejs.cn/s/gFdjtJ" target="_blank" rel="noopener noreferrer"><code>'drain'</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 事件被触发。</p> <p>当流还未被排空时，调用 <code>write()</code> 会缓冲 <code>chunk</code>，并返回 <code>false</code>。 一旦所有当前缓冲的数据块都被排空了（被操作系统接收并传输），则触发 <code>'drain'</code> 事件。 建议一旦 <code>write()</code> 返回 false，则不再写入任何数据块，直到 <code>'drain'</code> 事件被触发。 当流还未被排空时，也是可以调用 <code>write()</code>，Node.js 会缓冲所有被写入的数据块，直到达到最大内存占用，这时它会无条件中止。 甚至在它中止之前， 高内存占用将会导致垃圾回收器的性能变差和 RSS 变高（即使内存不再需要，通常也不会被释放回系统）。 如果远程的另一端没有读取数据，TCP 的 socket 可能永远也不会排空，所以写入到一个不会排空的 socket 可能会导致远程可利用的漏洞。</p> <p>对于 <a href="http://nodejs.cn/s/fhVJQM" target="_blank" rel="noopener noreferrer"><code>Transform</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, 写入数据到一个不会排空的流尤其成问题，因为 <code>Transform</code> 流默认会被暂停，直到它们被 pipe 或者添加了 <code>'data'</code> 或 <code>'readable'</code> 事件句柄。</p> <p>如果要被写入的数据可以根据需要生成或者取得，建议将逻辑封装为一个<a href="http://nodejs.cn/s/YuDKX1" target="_blank" rel="noopener noreferrer">可读流<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>并且使用 <a href="http://nodejs.cn/s/Ea2ZNW" target="_blank" rel="noopener noreferrer"><code>stream.pipe()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。 如果要优先调用 <code>write()</code>，则可以使用 <a href="http://nodejs.cn/s/gFdjtJ" target="_blank" rel="noopener noreferrer"><code>'drain'</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 事件来防止背压与避免内存问题:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>stream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    stream<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">'drain'</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 在回调函数被执行后再进行其他的写入。</span>
<span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'完成写入，可以进行更多的写入'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>对象模式下的可写流将会始终忽略 <code>encoding</code> 参数。</p></li></ul> <h2 id="_4-可读流-stream-readable"><a href="#_4-可读流-stream-readable" class="header-anchor">🌙</a> 4.可读流 <code>stream.Readable</code></h2> <p>可读流是对提供数据的来源的一种抽象。</p> <p>可读流的例子包括：</p> <ul><li><a href="http://nodejs.cn/s/2RqpEw" target="_blank" rel="noopener noreferrer">客户端的 HTTP 响应<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://nodejs.cn/s/2RqpEw" target="_blank" rel="noopener noreferrer">服务器的 HTTP 请求<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://nodejs.cn/s/C3Eioq" target="_blank" rel="noopener noreferrer">fs 的读取流<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://nodejs.cn/s/duYbh2" target="_blank" rel="noopener noreferrer">zlib 流<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://nodejs.cn/s/FuEfsg" target="_blank" rel="noopener noreferrer">crypto 流<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://nodejs.cn/s/wsJ1o1" target="_blank" rel="noopener noreferrer">TCP socket<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://nodejs.cn/s/F2vs59" target="_blank" rel="noopener noreferrer">子进程 stdout 与 stderr<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://nodejs.cn/s/gagmJq" target="_blank" rel="noopener noreferrer"><code>process.stdin</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>所有<a href="http://nodejs.cn/s/YuDKX1" target="_blank" rel="noopener noreferrer">可读流<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>都实现了 <code>stream.Readable</code> 类定义的接口。</p> <h3 id="_4-1-两种读取模式"><a href="#_4-1-两种读取模式" class="header-anchor">🌙</a> 4.1 两种读取模式</h3> <ul><li>流动模式（flowing）：数据自动从底层系统读取，并通过 <a href="http://nodejs.cn/s/pGAddE" target="_blank" rel="noopener noreferrer"><code>EventEmitter</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 接口的事件尽可能快地被提供给应用程序。</li> <li>暂停模式（paused）：必须显式调用 <a href="http://nodejs.cn/s/SpgRaa" target="_blank" rel="noopener noreferrer"><code>stream.read()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 读取数据块。</li></ul> <p>所有<a href="http://nodejs.cn/s/YuDKX1" target="_blank" rel="noopener noreferrer">可读流<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>都开始于暂停模式，可以通过以下方式切换到<strong>流动模式</strong>：</p> <ul><li>添加 <a href="http://nodejs.cn/s/8CCPjN" target="_blank" rel="noopener noreferrer"><code>'data'</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 事件句柄。</li> <li>调用 <a href="http://nodejs.cn/s/Zhf28N" target="_blank" rel="noopener noreferrer"><code>stream.resume()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 方法。</li> <li>调用 <a href="http://nodejs.cn/s/Ea2ZNW" target="_blank" rel="noopener noreferrer"><code>stream.pipe()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 方法将数据发送到<a href="http://nodejs.cn/s/9JUnJ8" target="_blank" rel="noopener noreferrer">可写流<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</li></ul> <p>可读流可以通过以下方式切换回<strong>暂停模式</strong>：</p> <ul><li>如果没有管道目标，则调用 <a href="http://nodejs.cn/s/jqytVw" target="_blank" rel="noopener noreferrer"><code>stream.pause()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</li> <li>如果有管道目标，则移除所有管道目标。调用 <a href="http://nodejs.cn/s/35GqHX" target="_blank" rel="noopener noreferrer"><code>stream.unpipe()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 可以移除多个管道目标。</li></ul> <h3 id="_4-2-三种状态"><a href="#_4-2-三种状态" class="header-anchor">🌙</a> 4.2 三种状态</h3> <p>在任意时刻，可读流会处于以下三种状态之一：</p> <ul><li><code>readable.readableFlowing === null</code></li> <li><code>readable.readableFlowing === false</code></li> <li><code>readable.readableFlowing === true</code></li></ul> <p>当 <code>readable.readableFlowing</code> 为 <code>null</code> 时，没有提供消费流数据的机制，所以流不会产生数据。 在这个状态下，监听 <code>'data'</code> 事件、调用 <code>readable.pipe()</code>、或调用 <code>readable.resume()</code> 都会使 <code>readable.readableFlowing</code> 切换到 <code>true</code>，可读流开始主动地产生数据并触发事件。</p> <p>调用 <code>readable.pause()</code>、 <code>readable.unpipe()</code>、或接收到背压，则 <code>readable.readableFlowing</code> 会被设为 <code>false</code>，暂时停止事件流动但不会停止数据的生成。 在这个状态下，为 <code>'data'</code> 事件绑定监听器不会使 <code>readable.readableFlowing</code> 切换到 <code>true</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> PassThrough<span class="token punctuation">,</span> Writable <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PassThrough</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> writable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Writable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

pass<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writable<span class="token punctuation">)</span><span class="token punctuation">;</span>
pass<span class="token punctuation">.</span><span class="token function">unpipe</span><span class="token punctuation">(</span>writable<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// readableFlowing 现在为 false。</span>

pass<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chunk<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pass<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 不会触发 'data' 事件。</span>
pass<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 必须调用它才会触发 'data' 事件。</span>
</code></pre></div><p>当 <code>readable.readableFlowing</code> 为 <code>false</code> 时，数据可能会堆积在流的内部缓冲中。</p> <h3 id="_4-3-stream-readable事件"><a href="#_4-3-stream-readable事件" class="header-anchor">🌙</a> 4.3 <code>stream.Readable</code>事件</h3> <table><thead><tr><th>事件名称</th> <th>说明</th></tr></thead> <tbody><tr><td><code>close</code></td> <td>流或其底层资源（比如文件描述符）被关闭时触发 <code>'close'</code> 事件。 该事件表明不会再触发其他事件，也不会再发生操作。如果使用 <code>emitClose</code> 选项创建<a href="http://nodejs.cn/s/YuDKX1" target="_blank" rel="noopener noreferrer">可读流<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，则它将会始终发出 <code>'close'</code> 事件。</td></tr> <tr><td><code>data</code></td> <td>当流将数据块传送给消费者后触发。 当调用 <code>readable.pipe()</code>， <code>readable.resume()</code> 或绑定监听器到 <code>'data'</code> 事件时，流会转换到流动模式。 当调用 <code>readable.read()</code> 且有数据块返回时，也会触发 <code>'data'</code> 事件。将 <code>'data'</code> 事件监听器附加到尚未显式暂停的流将会使流切换为流动模式。 数据将会在可用时立即传递。</td></tr> <tr><td><code>end</code></td> <td>当流中没有数据可供消费时触发。<code>'end'</code> 事件只有在数据被完全消费掉后才会触发。 要想触发该事件，可以将流转换到流动模式，或反复调用 <a href="http://nodejs.cn/s/SpgRaa" target="_blank" rel="noopener noreferrer"><code>stream.read()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 直到数据被消费完。</td></tr> <tr><td><code>error</code></td> <td><code>'error'</code> 事件可能随时由 <code>Readable</code> 实现触发。 通常，如果底层的流由于底层内部的故障而无法生成数据，或者流的实现尝试推送无效的数据块，则可能会发生这种情况。监听器回调将会传入一个 <code>Error</code> 对象。</td></tr> <tr><td><code>pause</code></td> <td>当调用 <a href="http://nodejs.cn/s/jqytVw" target="_blank" rel="noopener noreferrer"><code>stream.pause()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 并且 <code>readsFlowing</code> 不为 <code>false</code> 时，就会触发 <code>'pause'</code> 事件。</td></tr> <tr><td><code>readable</code></td> <td>当有数据可从流中读取时，就会触发 <code>'readable'</code> 事件。 在某些情况下，为 <code>'readable'</code> 事件附加监听器将会导致将一些数据读入内部缓冲区。</td></tr> <tr><td><code>resume</code></td> <td>当调用 <a href="http://nodejs.cn/s/Zhf28N" target="_blank" rel="noopener noreferrer"><code>stream.resume()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 并且 <code>readsFlowing</code> 不为 <code>true</code> 时，将会触发 <code>'resume'</code> 事件。</td></tr></tbody></table> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> readable <span class="token operator">=</span> <span class="token function">getReadableStreamSomehow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
readable<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">接收到 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chunk<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 个字节的数据</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> readable <span class="token operator">=</span> <span class="token function">getReadableStreamSomehow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
readable<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">接收到 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chunk<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 个字节的数据</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
readable<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'已没有数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_4-4-stream-readable方法"><a href="#_4-4-stream-readable方法" class="header-anchor">🌙</a> 4.4 <code>stream.Readable</code>方法</h3> <ul><li><p><code>readable.destroy([error])</code>：销毁流。 可选地触发 <code>'error'</code> 事件，并触发 <code>'close'</code> 事件（除非将 <code>emitClose</code> 设置为 <code>false</code>）。 在此调用之后，可读流将会释放所有内部的资源，并且将会忽略对 <code>push()</code> 的后续调用。</p> <p>一旦调用 <code>destroy()</code>，则不会再执行任何其他操作，并且除了 <code>_destroy</code> 以外的其他错误都不会作为 <code>'error'</code> 触发。返回: <a href="http://nodejs.cn/s/v7Fsu2" target="_blank" rel="noopener noreferrer"><this><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></this></a></p></li> <li><p><code>readable.destroyed</code>：在调用 <a href="http://nodejs.cn/s/6VkV74" target="_blank" rel="noopener noreferrer"><code>readable.destroy()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 之后为 <code>true</code>。返回: <boolean></boolean></p></li> <li><p><code>readable.isPaused()</code>：<code>readable.isPaused()</code> 方法返回可读流当前的操作状态。 主要用于 <code>readable.pipe()</code> 底层的机制。返回: <boolean></boolean></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> readable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">stream<span class="token punctuation">.</span>Readable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

readable<span class="token punctuation">.</span><span class="token function">isPaused</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// === false</span>
readable<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
readable<span class="token punctuation">.</span><span class="token function">isPaused</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// === true</span>
readable<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
readable<span class="token punctuation">.</span><span class="token function">isPaused</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// === false</span>
</code></pre></div></li> <li><p><code>readable.pause()</code>：<code>readable.pause()</code> 方法使流动模式的流停止触发 <a href="http://nodejs.cn/s/8CCPjN" target="_blank" rel="noopener noreferrer"><code>'data'</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 事件，并切换出流动模式。 任何可用的数据都会保留在内部缓存中。返回: <a href="http://nodejs.cn/s/v7Fsu2" target="_blank" rel="noopener noreferrer"><this><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></this></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> readable <span class="token operator">=</span> <span class="token function">getReadableStreamSomehow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
readable<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">接收到 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chunk<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 字节的数据</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  readable<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'暂停一秒'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据重新开始流动'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    readable<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果存在 <code>'readable'</code> 事件监听器，则 <code>readable.pause()</code> 方法不起作用。</p></li> <li><p><code>readable.pipe(destination[, options])</code>:</p> <ul><li><code>destination</code> <a href="http://nodejs.cn/s/9JUnJ8" target="_blank" rel="noopener noreferrer">&lt;stream.Writable&gt;<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 数据写入的目标。</li> <li><code>options</code> <a href="http://nodejs.cn/s/jzn6Ao" target="_blank" rel="noopener noreferrer"><object><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></object></a> 管道选项。
<ul><li><code>end</code> <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="noopener noreferrer"><boolean><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></boolean></a> 当读取器结束时终止写入器。<strong>默认值:</strong> <code>true</code>。</li></ul></li> <li>返回: <a href="http://nodejs.cn/s/9JUnJ8" target="_blank" rel="noopener noreferrer">&lt;stream.Writable&gt;<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 目标可写流，如果是 <a href="http://nodejs.cn/s/2iRabr" target="_blank" rel="noopener noreferrer"><code>Duplex</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 流或 <a href="http://nodejs.cn/s/fhVJQM" target="_blank" rel="noopener noreferrer"><code>Transform</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 流则可以形成管道链。</li></ul> <p><code>readable.pipe()</code> 方法绑定可写流到可读流，将可读流自动切换到流动模式，并将可读流的所有数据推送到绑定的可写流。 数据流会被自动管理，所以即使可读流更快，目标可写流也不会超负荷。</p> <p><code>readable.pipe()</code> 会返回目标流的引用，这样就可以对流进行链式地管道操作：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> r <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'file.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> z <span class="token operator">=</span> zlib<span class="token punctuation">.</span><span class="token function">createGzip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> w <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'file.txt.gz'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
r<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>默认情况下，当来源可读流触发 <a href="http://nodejs.cn/s/ZgviqU" target="_blank" rel="noopener noreferrer"><code>'end'</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 事件时，目标可写流也会调用 <a href="http://nodejs.cn/s/nvArK4" target="_blank" rel="noopener noreferrer"><code>stream.end()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 结束写入。 若要禁用这种默认行为， <code>end</code> 选项应设为 <code>false</code>，这样目标流就会保持打开：</p> <div class="language-js extra-class"><pre class="language-js"><code>reader<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writer<span class="token punctuation">,</span> <span class="token punctuation">{</span> end<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
reader<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  writer<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'结束'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p><code>readable.read([size])</code>:</p> <ul><li><code>size</code> <a href="http://nodejs.cn/s/SXbo1v" target="_blank" rel="noopener noreferrer"><number><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></number></a> 要读取的数据的字节数。</li> <li>返回: <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="noopener noreferrer"><string><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></string></a> | <a href="http://nodejs.cn/s/6x1hD3" target="_blank" rel="noopener noreferrer"><Buffer><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></Buffer></a> | <a href="http://nodejs.cn/s/334hvC" target="_blank" rel="noopener noreferrer"><null><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></null></a> | <a href="http://nodejs.cn/s/6sTGdS" target="_blank" rel="noopener noreferrer"><any><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></any></a></li></ul> <p>从内部缓冲拉取并返回数据。 如果没有可读的数据，则返回 <code>null</code>。 默认情况下， <code>readable.read()</code> 返回的数据是 <code>Buffer</code> 对象，除非使用 <code>readable.setEncoding()</code> 指定字符编码或流处于对象模式。</p> <p>可选的 <code>size</code> 参数指定要读取的特定字节数。 如果无法读取 <code>size</code> 个字节，则除非流已结束，否则将会返回 <code>null</code>，在这种情况下，将会返回内部 buffer 中剩余的所有数据。</p> <p>如果没有指定 <code>size</code> 参数，则返回内部缓冲中的所有数据。</p> <p><code>size</code> 参数必须小于或等于 1 GB。</p> <p><code>readable.read()</code> 应该只对处于暂停模式的可读流调用。 在流动模式中， <code>readable.read()</code> 会自动调用直到内部缓冲的数据完全耗尽。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> readable <span class="token operator">=</span> <span class="token function">getReadableStreamSomehow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
readable<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'readable'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> chunk<span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!==</span> <span class="token punctuation">(</span>chunk <span class="token operator">=</span> readable<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">接收到 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chunk<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 字节的数据</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>使用 <code>readable.read()</code> 处理数据时， <code>while</code> 循环是必需的。 只有在 <code>readable.read()</code> 返回 <code>null</code> 之后，才会触发 <a href="http://nodejs.cn/s/J6CZGb" target="_blank" rel="noopener noreferrer"><code>'readable'</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>对象模式下的可读流将会始终从调用 <a href="http://nodejs.cn/s/SpgRaa" target="_blank" rel="noopener noreferrer"><code>readable.read(size)</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 返回单个子项，而不管 <code>size</code> 参数的值如何。</p> <p>如果 <code>readable.read()</code> 返回一个数据块，则 <code>'data'</code> 事件也会触发。</p> <p>在 <a href="http://nodejs.cn/s/ZgviqU" target="_blank" rel="noopener noreferrer"><code>'end'</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 事件触发后再调用 <a href="http://nodejs.cn/s/SpgRaa" target="_blank" rel="noopener noreferrer"><code>stream.read([size\])</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 会返回 <code>null</code>。 不会引发运行时错误。</p></li> <li><p><code>readable.readable</code>:如果可以安全地调用 <a href="http://nodejs.cn/s/SpgRaa" target="_blank" rel="noopener noreferrer"><code>readable.read()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（这意味着流没有被破坏或触发 <code>'error'</code> 或 <code>'end'</code>），则为 <code>true</code>。</p></li> <li><p><code>readable.readableEncoding</code>：获取用于给定可读流的 <code>encoding</code> 属性。 可以使用 <a href="http://nodejs.cn/s/SjJGhm" target="_blank" rel="noopener noreferrer"><code>readable.setEncoding()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 方法设置 <code>encoding</code> 属性。</p></li> <li><p><code>readable.readableEnded</code>： 当 <a href="http://nodejs.cn/s/ZgviqU" target="_blank" rel="noopener noreferrer"><code>'end'</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 事件被触发时变为 <code>true</code>。</p></li> <li><p><code>readable.resume()</code>：返回<a href="http://nodejs.cn/s/v7Fsu2" target="_blank" rel="noopener noreferrer"><this><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></this></a></p> <p><code>readable.resume()</code> 方法将被暂停的可读流恢复触发 <a href="http://nodejs.cn/s/8CCPjN" target="_blank" rel="noopener noreferrer"><code>'data'</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 事件，并将流切换到流动模式。</p> <p><code>readable.resume()</code> 方法可以用来充分消耗流中的数据，但无需实际处理任何数据：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">getReadableStreamSomehow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'到达流的尽头，但无需读取任何数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>当存在 <code>'readable'</code> 事件监听器时， <code>readable.resume()</code> 方法不起作用。</p></li> <li><p><code>readable.setEncoding(encoding)</code>:</p> <ul><li><code>encoding</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="noopener noreferrer"><string><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></string></a> 字符编码。</li> <li>返回: <a href="http://nodejs.cn/s/v7Fsu2" target="_blank" rel="noopener noreferrer"><this><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></this></a></li></ul> <p><code>readable.setEncoding()</code> 方法为从可读流读取的数据设置字符编码。</p> <p>默认情况下没有设置字符编码，流数据返回的是 <code>Buffer</code> 对象。 如果设置了字符编码，则流数据返回指定编码的字符串。 例如，调用 <code>readable.setEncoding('utf-8')</code> 会将数据解析为 UTF-8 数据，并返回字符串，调用 <code>readable.setEncoding('hex')</code> 则会将数据编码成十六进制字符串。</p> <p>可读流将会正确地处理通过流传递的多字节字符，否则如果简单地从流中作为 <code>Buffer</code> 对象拉出，则会被不正确地解码。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> readable <span class="token operator">=</span> <span class="token function">getReadableStreamSomehow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
readable<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
readable<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> chunk<span class="token punctuation">,</span> <span class="token string">'string'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'读取到 %d 个字符的字符串数据'</span><span class="token punctuation">,</span> chunk<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p><code>readable.unpipe([destination])</code>:</p> <ul><li><code>destination</code> <a href="http://nodejs.cn/s/9JUnJ8" target="_blank" rel="noopener noreferrer">&lt;stream.Writable&gt;<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 要移除管道的可写流。</li> <li>返回: <a href="http://nodejs.cn/s/v7Fsu2" target="_blank" rel="noopener noreferrer"><this><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></this></a></li></ul> <p><code>readable.unpipe()</code> 方法解绑之前使用 <a href="http://nodejs.cn/s/Ea2ZNW" target="_blank" rel="noopener noreferrer"><code>stream.pipe()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 方法绑定的可写流。</p> <p>如果没有指定 <code>destination</code>, 则解绑所有管道.</p> <p>如果指定了 <code>destination</code>, 但它没有建立管道，则不起作用.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> readable <span class="token operator">=</span> <span class="token function">getReadableStreamSomehow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> writable <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'file.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 可读流的所有数据开始传输到 'file.txt'，但一秒后停止。</span>
readable<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writable<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'停止写入 file.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  readable<span class="token punctuation">.</span><span class="token function">unpipe</span><span class="token punctuation">(</span>writable<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'手动关闭文件流'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  writable<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p><code>readable.unshift(chunk[, encoding])</code>:<code>readable.unshift()</code> 方法将数据块推回内部缓冲。</p> <p>​	可用于以下情景：正被消费中的流需要将一些已经被拉出的数据重置为未消费状态，以便这些数据可以传给其他方。</p> <p>​	触发 <a href="http://nodejs.cn/s/ZgviqU" target="_blank" rel="noopener noreferrer"><code>'end'</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 事件或抛出运行时错误之后，不能再调用 <code>stream.unshift()</code> 方法。</p> <p>使用 <code>stream.unshift()</code> 的开发者可以考虑切换到 <a href="http://nodejs.cn/s/fhVJQM" target="_blank" rel="noopener noreferrer"><code>Transform</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 流。 详见<a href="http://nodejs.cn/s/d2EgSi" target="_blank" rel="noopener noreferrer">用于实现流的API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 拉出由 \n\n 分隔的标题。</span>
<span class="token comment">// 如果获取太多，则使用 unshift()。</span>
<span class="token comment">// 使用 (error, header, stream) 调用回调。</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> StringDecoder <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'string_decoder'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">parseHeader</span><span class="token punctuation">(</span><span class="token parameter">stream<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  stream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  stream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'readable'</span><span class="token punctuation">,</span> onReadable<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> decoder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringDecoder</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> header <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">onReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> chunk<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!==</span> <span class="token punctuation">(</span>chunk <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> str <span class="token operator">=</span> decoder<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/\n\n/</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 发现头部边界。</span>
        <span class="token keyword">const</span> split <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/\n\n/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        header <span class="token operator">+=</span> split<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> remaining <span class="token operator">=</span> split<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>remaining<span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        stream<span class="token punctuation">.</span><span class="token function">removeListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 在调用 unshift() 前移除 'readable' 监听器。</span>
        stream<span class="token punctuation">.</span><span class="token function">removeListener</span><span class="token punctuation">(</span><span class="token string">'readable'</span><span class="token punctuation">,</span> onReadable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>buf<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
          stream<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 现在可以从流中读取消息的主体。</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> header<span class="token punctuation">,</span> stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 继续读取头部。</span>
        header <span class="token operator">+=</span> str<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>与 <a href="http://nodejs.cn/s/8s3paZ" target="_blank" rel="noopener noreferrer"><code>stream.push(chunk)</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 不同， <code>stream.unshift(chunk)</code> 不会通过重置流的内部读取状态来结束读取过程。 如果在读取期间调用 <code>readable.unshift()</code>（即从自定义的流上的 <a href="http://nodejs.cn/s/5hv4Rd" target="_blank" rel="noopener noreferrer"><code>stream._read()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 实现中调用），则会导致意外结果。 在使用立即的 <a href="http://nodejs.cn/s/8s3paZ" target="_blank" rel="noopener noreferrer"><code>stream.push('')</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 调用 <code>readable.unshift()</code> 之后，将适当地重置读取状态，但最好在执行读取的过程中避免调用 <code>readable.unshift()</code>。</p></li></ul> <h2 id="_5-双工流与转换流"><a href="#_5-双工流与转换流" class="header-anchor">🌙</a> 5.双工流与转换流</h2> <h3 id="_5-1-stream-duplex-双工流"><a href="#_5-1-stream-duplex-双工流" class="header-anchor">🌙</a> 5.1 <code>stream.Duplex</code> 双工流</h3> <p>双工流（Duplex）是同时实现了 <a href="http://nodejs.cn/s/YuDKX1" target="_blank" rel="noopener noreferrer"><code>Readable</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和 <a href="http://nodejs.cn/s/9JUnJ8" target="_blank" rel="noopener noreferrer"><code>Writable</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 接口的流。</p> <p><code>Duplex</code> 流的例子包括：</p> <ul><li><a href="http://nodejs.cn/s/wsJ1o1" target="_blank" rel="noopener noreferrer">TCP socket<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://nodejs.cn/s/duYbh2" target="_blank" rel="noopener noreferrer">zlib 流<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://nodejs.cn/s/FuEfsg" target="_blank" rel="noopener noreferrer">crypto 流<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="_5-2-stream-transform-转换流"><a href="#_5-2-stream-transform-转换流" class="header-anchor">🌙</a> 5.2 <code>stream.Transform</code> 转换流</h3> <ul><li><code>transform.destroy([error])</code>：销毁流，并可选地触发 <code>'error'</code> 事件。</li></ul> <p>转换流（Transform）是一种 <a href="http://nodejs.cn/s/2iRabr" target="_blank" rel="noopener noreferrer"><code>Duplex</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 流，但它的输出与输入是相关联的。 与 <a href="http://nodejs.cn/s/2iRabr" target="_blank" rel="noopener noreferrer"><code>Duplex</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 流一样， <code>Transform</code> 流也同时实现了 <a href="http://nodejs.cn/s/YuDKX1" target="_blank" rel="noopener noreferrer"><code>Readable</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和 <a href="http://nodejs.cn/s/9JUnJ8" target="_blank" rel="noopener noreferrer"><code>Writable</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 接口。</p> <p><code>Transform</code> 流的例子包括：</p> <ul><li><p><a href="http://nodejs.cn/s/duYbh2" target="_blank" rel="noopener noreferrer">zlib 流<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="http://nodejs.cn/s/FuEfsg" target="_blank" rel="noopener noreferrer">crypto 流<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul> <h2 id="_6-实现流"><a href="#_6-实现流" class="header-anchor">🌙</a> 6. 实现流</h2> <p><code>stream</code> 模块 API 旨在为了更容易地使用 JavaScript 的原型继承模式来实现流。</p> <p>首先，流的开发者声明一个新的 JavaScript 类，该类继承了四个基本流类之一（<code>stream.Writeable</code>、 <code>stream.Readable</code>、 <code>stream.Duplex</code> 或 <code>stream.Transform</code>），并确保调用了相应的父类构造函数:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Writable <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MyWritable</span> <span class="token keyword">extends</span> <span class="token class-name">Writable</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> highWaterMark<span class="token punctuation">,</span> <span class="token operator">...</span>options <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">{</span> highWaterMark <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_6-1-实现可写流"><a href="#_6-1-实现可写流" class="header-anchor">🌙</a> 6.1 实现可写流</h3> <p><code>stream.Writable</code> 类可用于实现 <a href="http://nodejs.cn/s/9JUnJ8" target="_blank" rel="noopener noreferrer"><code>Writable</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 流。</p> <p>自定义的 <code>Writable</code> 流必须调用 <code>new stream.Writable([options])</code> 构造函数并实现 <code>writable._write()</code> 和/或 <code>writable._writev()</code> 方法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Writable <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MyWritable</span> <span class="token keyword">extends</span> <span class="token class-name">Writable</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 调用 stream.Writable() 构造函数。</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">// ES6之前</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Writable <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> util <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">MyWritable</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">MyWritable</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyWritable</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">Writable</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
util<span class="token punctuation">.</span><span class="token function">inherits</span><span class="token punctuation">(</span>MyWritable<span class="token punctuation">,</span> Writable<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用简化的构造函数：</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Writable <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> myWritable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Writable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">write</span><span class="token punctuation">(</span><span class="token parameter">chunk<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">writev</span><span class="token punctuation">(</span><span class="token parameter">chunks<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_6-2-实现可读流"><a href="#_6-2-实现可读流" class="header-anchor">🌙</a> 6.2 实现可读流</h3> <p><code>stream.Readable</code> 类可用于实现可读流。</p> <p>自定义的可读流必须调用 <code>new stream.Readable([options])</code> 构造函数并实现 <code>readable._read()</code> 方法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Readable <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MyReadable</span> <span class="token keyword">extends</span> <span class="token class-name">Readable</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 调用 stream.Readable(options) 构造函数。</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用 ES6 之前的语法：</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Readable <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> util <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">MyReadable</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">MyReadable</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyReadable</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">Readable</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
util<span class="token punctuation">.</span><span class="token function">inherits</span><span class="token punctuation">(</span>MyReadable<span class="token punctuation">,</span> Readable<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用简化的构造函数：</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Readable <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> myReadable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Readable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">read</span><span class="token punctuation">(</span><span class="token parameter">size</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_6-3-实现双工流"><a href="#_6-3-实现双工流" class="header-anchor">🌙</a> 6.3 实现双工流</h3> <p><a href="http://nodejs.cn/s/2iRabr" target="_blank" rel="noopener noreferrer">双工流<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>同时实现了<a href="http://nodejs.cn/s/YuDKX1" target="_blank" rel="noopener noreferrer">可读流<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="http://nodejs.cn/s/9JUnJ8" target="_blank" rel="noopener noreferrer">可写流<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，例如 TCP socket 连接。</p> <p>因为 JavaScript 不支持多重继承，所以使用 <code>stream.Duplex</code> 类实现<a href="http://nodejs.cn/s/2iRabr" target="_blank" rel="noopener noreferrer">双工流<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（而不是使用 <code>stream.Readable</code> 类和 <code>stream.Writable</code> 类）。</p> <p><code>stream.Duplex</code> 类的原型继承自 <code>stream.Readable</code> 和寄生自 <code>stream.Writable</code>，但是 <code>instanceof</code> 对这两个基础类都可用，因为重写了 <code>stream.Writable</code> 的 <a href="http://nodejs.cn/s/D1EDvM" target="_blank" rel="noopener noreferrer"><code>Symbol.hasInstance</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>自定义的双工流必须调用 <code>new stream.Duplex([options])</code> 构造函数并实现 <code>readable._read()</code> 和 <code>writable._write()</code> 方法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Duplex <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MyDuplex</span> <span class="token keyword">extends</span> <span class="token class-name">Duplex</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用 ES6 之前的语法：</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Duplex <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> util <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">MyDuplex</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">MyDuplex</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyDuplex</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">Duplex</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
util<span class="token punctuation">.</span><span class="token function">inherits</span><span class="token punctuation">(</span>MyDuplex<span class="token punctuation">,</span> Duplex<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用简化的构造函数：</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Duplex <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> myDuplex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Duplex</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">read</span><span class="token punctuation">(</span><span class="token parameter">size</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">write</span><span class="token punctuation">(</span><span class="token parameter">chunk<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_6-4-实现转换流"><a href="#_6-4-实现转换流" class="header-anchor">🌙</a> 6.4 实现转换流</h3> <p><a href="http://nodejs.cn/s/fhVJQM" target="_blank" rel="noopener noreferrer">转换流<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是一种<a href="http://nodejs.cn/s/2iRabr" target="_blank" rel="noopener noreferrer">双工流<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，它会对输入做些计算然后输出。 例如 <a href="http://nodejs.cn/s/duYbh2" target="_blank" rel="noopener noreferrer">zlib<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 流和 <a href="http://nodejs.cn/s/FuEfsg" target="_blank" rel="noopener noreferrer">crypto<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 流会压缩、加密或解密数据。</p> <p>输出流的大小、数据块的数量都不一定会和输入流的一致。 例如， <code>Hash</code> 流在输入结束时只会输出一个数据块，而 <code>zlib</code> 流的输出可能比输入大很多或小很多。</p> <p><code>stream.Transform</code> 类可用于实现了一个<a href="http://nodejs.cn/s/fhVJQM" target="_blank" rel="noopener noreferrer">转换流<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p><code>stream.Transform</code> 类继承自 <code>stream.Duplex</code>，并且实现了自有的 <code>writable._write()</code> 和 <code>readable._read()</code> 方法。 自定义的转换流必须实现 <a href="http://nodejs.cn/s/N8nFbP" target="_blank" rel="noopener noreferrer"><code>transform._transform()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 方法，<a href="http://nodejs.cn/s/mErApk" target="_blank" rel="noopener noreferrer"><code>transform._flush()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 方法是可选的。</p> <p>当使用转换流时，如果可读端的输出没有被消费，则写入流的数据可能会导致可写端被暂停。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Transform <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MyTransform</span> <span class="token keyword">extends</span> <span class="token class-name">Transform</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用 ES6 之前的语法：</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Transform <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> util <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">MyTransform</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">MyTransform</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyTransform</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">Transform</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
util<span class="token punctuation">.</span><span class="token function">inherits</span><span class="token punctuation">(</span>MyTransform<span class="token punctuation">,</span> Transform<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用简化的构造函数：</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Transform <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> myTransform <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Transform</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">transform</span><span class="token punctuation">(</span><span class="token parameter">chunk<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div></div> <footer class="page-edit" style="display:none;"><div class="edit-link"><a href="https://github.com/vuejs/vuepress/edit/master/docs/backEnd/node/NodeJS之stream模块学习笔记.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <!----> <!----> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-514ac8aa><li class="level-2" data-v-514ac8aa><a href="/docs-zzy/backEnd/node/NodeJS%E4%B9%8Bstream%E6%A8%A1%E5%9D%97%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html#_1-stream（流）模块简介" class="sidebar-link" data-v-514ac8aa>1.stream（流）模块简介</a></li><li class="level-2" data-v-514ac8aa><a href="/docs-zzy/backEnd/node/NodeJS%E4%B9%8Bstream%E6%A8%A1%E5%9D%97%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html#_2-流的类型" class="sidebar-link" data-v-514ac8aa>2. 流的类型</a></li><li class="level-2" data-v-514ac8aa><a href="/docs-zzy/backEnd/node/NodeJS%E4%B9%8Bstream%E6%A8%A1%E5%9D%97%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html#_3-可写流-stream-writable" class="sidebar-link" data-v-514ac8aa>3.可写流 stream.Writable</a></li><li class="level-3" data-v-514ac8aa><a href="/docs-zzy/backEnd/node/NodeJS%E4%B9%8Bstream%E6%A8%A1%E5%9D%97%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html#_3-1-stream-writable-事件" class="sidebar-link" data-v-514ac8aa>3.1 stream.Writable 事件</a></li><li class="level-3" data-v-514ac8aa><a href="/docs-zzy/backEnd/node/NodeJS%E4%B9%8Bstream%E6%A8%A1%E5%9D%97%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html#_3-2-stream-writable方法" class="sidebar-link" data-v-514ac8aa>3.2 stream.Writable方法</a></li><li class="level-2" data-v-514ac8aa><a href="/docs-zzy/backEnd/node/NodeJS%E4%B9%8Bstream%E6%A8%A1%E5%9D%97%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html#_4-可读流-stream-readable" class="sidebar-link" data-v-514ac8aa>4.可读流 stream.Readable</a></li><li class="level-3" data-v-514ac8aa><a href="/docs-zzy/backEnd/node/NodeJS%E4%B9%8Bstream%E6%A8%A1%E5%9D%97%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html#_4-1-两种读取模式" class="sidebar-link" data-v-514ac8aa>4.1 两种读取模式</a></li><li class="level-3" data-v-514ac8aa><a href="/docs-zzy/backEnd/node/NodeJS%E4%B9%8Bstream%E6%A8%A1%E5%9D%97%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html#_4-2-三种状态" class="sidebar-link" data-v-514ac8aa>4.2 三种状态</a></li><li class="level-3" data-v-514ac8aa><a href="/docs-zzy/backEnd/node/NodeJS%E4%B9%8Bstream%E6%A8%A1%E5%9D%97%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html#_4-3-stream-readable事件" class="sidebar-link" data-v-514ac8aa>4.3 stream.Readable事件</a></li><li class="level-3" data-v-514ac8aa><a href="/docs-zzy/backEnd/node/NodeJS%E4%B9%8Bstream%E6%A8%A1%E5%9D%97%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html#_4-4-stream-readable方法" class="sidebar-link" data-v-514ac8aa>4.4 stream.Readable方法</a></li><li class="level-2" data-v-514ac8aa><a href="/docs-zzy/backEnd/node/NodeJS%E4%B9%8Bstream%E6%A8%A1%E5%9D%97%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html#_5-双工流与转换流" class="sidebar-link" data-v-514ac8aa>5.双工流与转换流</a></li><li class="level-3" data-v-514ac8aa><a href="/docs-zzy/backEnd/node/NodeJS%E4%B9%8Bstream%E6%A8%A1%E5%9D%97%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html#_5-1-stream-duplex-双工流" class="sidebar-link" data-v-514ac8aa>5.1 stream.Duplex 双工流</a></li><li class="level-3" data-v-514ac8aa><a href="/docs-zzy/backEnd/node/NodeJS%E4%B9%8Bstream%E6%A8%A1%E5%9D%97%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html#_5-2-stream-transform-转换流" class="sidebar-link" data-v-514ac8aa>5.2 stream.Transform 转换流</a></li><li class="level-2" data-v-514ac8aa><a href="/docs-zzy/backEnd/node/NodeJS%E4%B9%8Bstream%E6%A8%A1%E5%9D%97%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html#_6-实现流" class="sidebar-link" data-v-514ac8aa>6. 实现流</a></li><li class="level-3" data-v-514ac8aa><a href="/docs-zzy/backEnd/node/NodeJS%E4%B9%8Bstream%E6%A8%A1%E5%9D%97%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html#_6-1-实现可写流" class="sidebar-link" data-v-514ac8aa>6.1 实现可写流</a></li><li class="level-3" data-v-514ac8aa><a href="/docs-zzy/backEnd/node/NodeJS%E4%B9%8Bstream%E6%A8%A1%E5%9D%97%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html#_6-2-实现可读流" class="sidebar-link" data-v-514ac8aa>6.2 实现可读流</a></li><li class="level-3" data-v-514ac8aa><a href="/docs-zzy/backEnd/node/NodeJS%E4%B9%8Bstream%E6%A8%A1%E5%9D%97%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html#_6-3-实现双工流" class="sidebar-link" data-v-514ac8aa>6.3 实现双工流</a></li><li class="level-3" data-v-514ac8aa><a href="/docs-zzy/backEnd/node/NodeJS%E4%B9%8Bstream%E6%A8%A1%E5%9D%97%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html#_6-4-实现转换流" class="sidebar-link" data-v-514ac8aa>6.4 实现转换流</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-1e128e82 data-v-1e128e82><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-1e128e82><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-1e128e82></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-1e128e82></path></svg></div><APlayer audio="" fixed="true" theme="#b7daff" loop="loop" order="list" preload="auto" volume="0.7" mutex="true" lrc-type="0" list-max-height="250" storage-name="vuepress-plugin-meting"></APlayer></div></div>
    <script src="/docs-zzy/assets/js/app.f5fb1f06.js" defer></script><script src="/docs-zzy/assets/js/3.7a4e40be.js" defer></script><script src="/docs-zzy/assets/js/1.f25b10cd.js" defer></script><script src="/docs-zzy/assets/js/31.e76bf292.js" defer></script>
  </body>
</html>
